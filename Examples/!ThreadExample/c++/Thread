#include "Thread.h"
#include "WimpObj.h"

Thread::Thread(int objectId, int componentId, int eventCode, int delay) {
  this->objectId = objectId;
  this->componentId = componentId;
  this->eventCode = eventCode;
  this->delay = delay;
  startThread();
}

Thread::~Thread() {
  stopThread();
}

void Thread::startThread() {
  _kernel_swi_regs regs;
  regs.r[0] = objectId;
  regs.r[1] = componentId;
  regs.r[2] = eventCode;
  regs.r[3] = delay;
  regs.r[4] = ToolboxCoreObj::getTaskHandle();
  _kernel_swi(0x5AB40, &regs, &regs);
  handle = (ThreadData *) regs.r[0];
}

void Thread::stopThread() {
  _kernel_swi_regs regs;
  regs.r[0] = (int) handle;
  _kernel_swi(0x5AB41, &regs, &regs);
}
